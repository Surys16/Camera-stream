<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Start Game</title>
<style>
  body {
    background: #111;
    color: #fff;
    font-family: Arial;
    text-align: center;
    padding-top: 20px;
  }
  video {
    width: 90%;
    border: 2px solid #00ff88;
    border-radius: 8px;
  }
  button {
    padding: 12px 25px;
    font-size: 16px;
    margin: 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #00ff88;
    color: black;
  }
</style>
</head>
<body>

<h2>üéÆ Start Game</h2>

<video id="localVideo" autoplay muted playsinline></video><br>
<button id="startBtn">‚ñ∂ Start Game</button>
<button id="endBtn">‚èπ End Game</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

// üîπ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCMD_qYKFZQZveZQL1NX7oj3oFuTsRxaYI",
  authDomain: "camera-stream-15427.firebaseapp.com",
  databaseURL: "https://camera-stream-15427-default-rtdb.firebaseio.com",
  projectId: "camera-stream-15427",
  storageBucket: "camera-stream-15427.appspot.com",
  messagingSenderId: "437543558160",
  appId: "1:437543558160:web:32a8d80fdcd95b0568fe95"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const room = "room1";

const pc = new RTCPeerConnection({
  iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
});

// üîπ ICE candidate
pc.onicecandidate = e => {
  if (e.candidate) {
    push(ref(db, room + "/candidates"), e.candidate.toJSON());
  }
};

// üîπ Video track
pc.ontrack = e => {
  // Sender tidak perlu tampil di sender lagi
};

// üîπ Start Game
const startBtn = document.getElementById("startBtn");
let localStream;

startBtn.onclick = async () => {
  localStream = await navigator.mediaDevices.getUserMedia({ video: true });
  document.getElementById("localVideo").srcObject = localStream;

  localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  await set(ref(db, room + "/offer"), offer);

  // Terima jawaban viewer
  onValue(ref(db, room + "/answer"), snap => {
    if (snap.exists()) pc.setRemoteDescription(snap.val());
  });
};

// üîπ End Game
document.getElementById("endBtn").onclick = () => {
  localStream?.getTracks().forEach(track => track.stop());
  pc.close();
  alert("Game ended ‚úÖ");
};
</script>

</body>
</html>
